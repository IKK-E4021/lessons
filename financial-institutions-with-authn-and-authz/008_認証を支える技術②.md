# 008 : 認証を支える技術②

今回は「認証を支える技術」シリーズの第2弾として、ソーシャルログイン、OAuth 2.0、OpenID Connect、SAMLなどの技術について解説します。これらは複数のサービス間で認証情報を安全に連携させるための重要な基盤技術であり、現代のデジタルサービスに欠かせないものです。

## 📝 ① ソーシャルログイン
ソーシャルログインは、GoogleやFacebookなどの既存アカウントを使って別のサービスにログインできる機能です。新たなパスワードを覚える必要がなく、高度なセキュリティ対策を持つ大手プラットフォームの認証基盤を間接的に利用できます。技術的には、OAuth 2.0とOpenID Connectという仕組みで実装されています。

💬   
Bくん：「ソーシャルログインって便利ですよね！『Googleでログイン』ボタンとかよく見かけますが、これって何が起きてるんですか？」

Aさん：「うん、便利だよね。簡単に言うと、そのサービスが直接パスワード認証をせずに、GoogleやFacebookなどの『信頼できる第三者』に認証を任せているんだ。」

Bくん：「でも、どうやって安全に連携してるんですか？他社に認証を任せるって大丈夫なんですか？」

Aさん：「良い質問だね！裏側では『OAuth 2.0』や『OpenID Connect』という仕組みが使われているんだ。これによって、パスワードを共有することなく安全に認証情報をやり取りできるんだよ。例えば、Googleでログインする場合、あなたのパスワードは常にGoogleだけが知っていて、連携先のサービスには渡らないんだ。代わりに『この人は確かに認証済みのユーザーAさんです』という情報だけが安全な形で伝えられるんだよ。」

### 📌 ポイント
- ソーシャルログインは「機能・概念」であり、実際の仕組みとしてOAuth 2.0とOpenID Connectが使われる
- ユーザーはパスワードを覚える負担が減り、サービス提供者は認証管理の負担が軽減される
- パスワードは認証プロバイダー（GoogleやFacebookなど）だけが管理し、連携先には渡らない
- 大手プラットフォームの高度なセキュリティ対策（二段階認証など）の恩恵を受けられる

## 📝 ② OAuth 2.0
OAuth 2.0は、サービス間で安全に権限を委譲するための仕組みです。ユーザーのパスワードを共有せずに、特定のサービスや情報へのアクセス権だけを別のアプリやサービスに与えることができます。「連携アプリがGmailの連絡先だけにアクセスできるようにする」といったケースで使われます。

💬   
Aさん：「OAuth 2.0は『別のサービスの一部機能を借りる』ための仕組みなんだ。ソーシャルログインの裏側でも使われているよ。」

Bくん：「借りるって、どういう意味ですか？」

Aさん：「例えば、あるアプリがGmailの連絡先を使いたい場合、昔はGmailのパスワードをそのアプリに教える必要があったんだ。でも、それって全権限を渡すことになって危険だよね。OAuthを使えば『連絡先の読み取り権限だけ』を安全に渡せるんだ。

わかりやすく例えるなら：
- あなた（権限を持っている人）
- 連携したいアプリ（権限を借りたい人）
- Google（権限を管理している人）
- Gmailサーバー（実際の情報がある場所）
って感じかな。」

Bくん：「なるほど！でも実際の流れはどうなってるんですか？」

Aさん：「基本的な流れはこんな感じだよ：
1. まず、アプリがGoogleに『この権限をください』って申請する
2. Googleは『このアプリに権限をあげてもいい？』ってユーザーに確認を求める
3. ユーザーがOKすると、アプリは『入場チケット』みたいなものをもらえる
4. そのチケットを使ってGmailの連絡先にアクセスできるようになる

このチケットには有効期限があるし、特定の機能にしかアクセスできないから安全なんだよ。ソーシャルログインでは、このOAuthの仕組みがベースになっていて、その上にOpenID Connectという認証の仕組みが追加されているんだ。」

### 📌 ポイント
- OAuth 2.0は「権限を一部だけ貸し出す」ための仕組みで、ソーシャルログインの技術的基盤の一部
- パスワード共有なしに、特定の権限だけを別のサービスに渡せる
- 期限付き・権限制限付きの「チケット」のような仕組みが中心
- ユーザーの明示的な同意を得てから権限を与える流れになっている

## 📝 ③ OpenID Connect (OIDC)
OpenID Connectは、OAuth 2.0を拡張して認証機能を追加した仕組みです。OAuthが「権限の貸し出し」を目的とするのに対し、OpenID Connectは「ユーザー認証」を主な目的としています。ソーシャルログインの実装には通常このOpenID Connectが使用され、ユーザー情報を安全に伝えます。

💬   
Aさん：「次はOpenID Connect、略してOIDCだね。これはOAuth 2.0の上に認証機能を追加したもので、ソーシャルログインの中核技術なんだ。」

Bくん：「OAuthとの違いがイマイチわからないんですけど...」

Aさん：「シンプルに言うと、OAuthは『〇〇の機能を使わせてください』という権限貸し出しの仕組みで、OpenID Connectは『この人が本当に〇〇さんであることを証明します』という身分証明の仕組みなんだ。

OpenID Connectの特徴は『デジタル身分証明書』のようなものを発行すること。この身分証明書には、ユーザーの基本情報（名前、メールアドレスなど）が含まれていて、偽造できないよう電子的な封印がされているんだ。

日常で例えると、OAuthは「この人に家の冷蔵庫を開ける権限をあげます」という感じで、OpenID Connectは「この人は確かに田中さんです」という感じかな。」

Bくん：「なるほど！じゃあ、『Googleでログイン』ボタンを押したとき、裏側ではOpenID Connectが動いてるんですね？」

Aさん：「そのとおり！『Googleでログイン』を押すと、Googleがユーザーを認証して、デジタル身分証明書を発行し、そのサイトは証明書からユーザー情報を取得して、アカウントを作成したり紐づけたりしているんだ。ソーシャルログインは『機能・概念』で、それを実現する技術がOAuth 2.0とOpenID Connectというわけだよ。金融サービスなどのセキュリティ要件が高い場面では、さらに厳格なセキュリティルールを追加することもあるよ。」

### 📌 ポイント
- OpenID Connectは「誰であるか」を証明するための仕組みで、ソーシャルログインを実装する主要技術
- OAuth 2.0をベースに認証機能を追加している
- デジタル身分証明書のような仕組みで、安全にユーザー情報を伝える
- 標準化された情報項目により、サービス間で互換性のあるユーザー情報連携が可能

## 📝 ④ SAML
SAML（サムル）は、主に企業や組織内での認証連携に使われる仕組みです。OpenID Connectより歴史が長く、特に大規模な企業システムやクラウドサービスとの連携で広く採用されています。

💬   
Bくん：「SAMLって聞いたことはあるんですけど、OpenID Connectとどう違うんですか？」

Aさん：「SAMLはOpenID Connectより前から存在する技術で、主に企業内の一括ログイン（シングルサインオン）に使われることが多いんだ。例えば、社内ポータルにログインしたら、Salesforceや社内のさまざまなウェブシステムにも自動的にログインできる、みたいな仕組みだね。」

Bくん：「へぇ〜、でもなんでOpenID Connectじゃなく、SAMLを使うんですか？」

Aさん：「いい質問だね！SAMLとOpenID Connectはどちらも認証連携のための仕組みだけど、SAMLの方が歴史が長いから、特に大企業の既存システムとの相性が良いんだ。企業のセキュリティルールに合わせた細かい設定ができるのも特徴だよ。

SAMLは特殊な形式のデジタル身分証明書を使っていて、企業の認証サーバーが「この社員は認証済みです」という証明書を発行し、それを各サービスに渡す仕組みになっているんだ。

一方、OpenID Connectはスマホアプリや最新のウェブアプリとの相性が良くて、導入が比較的簡単なんだ。どちらを選ぶかは、既存システムや連携したいサービスの対応状況、セキュリティ要件などで決めることが多いよ。」

Bくん：「なるほど！古いシステムとの連携にはSAML、新しいアプリとの連携にはOpenID Connectが向いているって感じですね？」

Aさん：「そうだね、かなりシンプルにまとめるとそんな感じ。でも最近は両方に対応した認証サービスも増えているから、状況に応じて使い分けることもできるよ。」

### 📌 ポイント
- SAMLは主に企業内の一括ログイン(シングルサインオン)に利用される
- 企業システムとの相性が良く、詳細なセキュリティ設定が可能
- OpenID Connectと比べて設定が複雑だが、大規模組織のニーズに対応
- 既存の大企業システムとの連携に適している


------------------------------------------------------------------------------------------

## まとめ
今回は認証連携の重要な技術である、ソーシャルログイン、OAuth 2.0、OpenID Connect、SAMLについて解説しました。ソーシャルログインはユーザーにとって便利な機能であり、その実装にはOAuth 2.0とOpenID Connectという標準的な仕組みが使用されています。これらの技術は、強固なセキュリティを維持しながらも、サービス間の円滑な連携を可能にする重要な役割を果たしています。金融サービスにおいても、これらの技術を活用して安全かつ便利なサービス連携が可能となり、より良い顧客体験を提供することができます。

### 📌📌今回のポイント📌📌
1. ソーシャルログインは「機能・概念」であり、実際の仕組みとしてOAuth 2.0とOpenID Connectが使われる
2. OAuth 2.0は「権限の一部だけを貸し出す」ための仕組みで、パスワード共有なしに特定の機能だけを安全に利用させる
3. OpenID Connectは「身分証明」に特化した仕組みで、ユーザー情報を安全に伝えるデジタル身分証明書のような機能がある
4. SAMLは主に企業内システムの一括ログインに利用される、歴史のある認証連携の仕組み
5. どの技術を選択するかは、用途、セキュリティ要件、連携先のサポート状況などを考慮して決定する

## 参考資料
[1] OpenID Connect Core 1.0 [https://openid.net/specs/openid-connect-core-1_0.html]  
[2] OAuth 2.0 Authorization Framework [https://datatracker.ietf.org/doc/html/rfc6749]  
[3] Financial-grade API Security Profile [https://openid.net/specs/openid-financial-api-part-1-1_0.html]  
[4] SAML V2.0 Technical Overview [http://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html]  
