# 007 : 認証を支える技術①

今回は認証システムの裏側で動いている重要な技術について解説します。共通鍵暗号方式、ハッシュ化、公開鍵暗号方式といった技術は、私たちが日常的に使っている認証の安全性を支える基盤となっています。これらの技術を理解することで、なぜパスワードが安全に保管できるのか、なぜデジタル署名が信頼できるのかといった疑問が解消されるでしょう。

## 📝 ① 共通鍵暗号方式 - シンプルだけど鍵共有が課題
共通鍵暗号方式は、暗号化と復号に同じ鍵を使用する最も古典的な暗号化技術です。シンプルで処理速度が速い一方、安全に鍵を共有する方法が大きな課題となります。

💬   
Bくん：「Aさん、暗号化って聞くとなんだか難しそうなイメージがあります。一番基本的な暗号化の仕組みって何ですか？」

Aさん：「基本中の基本は『共通鍵暗号方式』だね。これは暗号化するときと復号するとき（元に戻すとき）に同じ鍵を使うシンプルな方式なんだ」

Bくん：「へぇ、同じ鍵を使うんですね。具体的にはどんな感じなんですか？」

Aさん：「例えるなら、ダイヤル錠付きの箱を想像してみて。Aliceさんは大切なメッセージを箱に入れて、ダイヤルを『1234』にセットして施錠する。Bobさんがこの箱を受け取ったら、同じ『1234』というダイヤル番号を知っていれば箱を開けられるよね。この『1234』が共通鍵なんだ。AES暗号やDES暗号などが有名な共通鍵暗号の例だよ」

Bくん：「なるほど！でも待ってください...Aliceさんは最初にBobさんに『1234』という鍵を教えないといけないわけですよね？それって安全にできるんですか？」

Aさん：「鋭いところに気づいたね！それが共通鍵暗号の最大の弱点なんだ。もし鍵を送る通信路が安全でなければ、途中で鍵が盗まれる可能性がある。かといって直接会って鍵を伝えるのも現実的じゃない。この『鍵配送問題』を解決するために生まれたのが、この後説明する公開鍵暗号方式なんだよ」

### 📌 ポイント
- 共通鍵暗号方式は暗号化と復号に同じ鍵を使用する
- 処理が高速で効率的なため、大量データの暗号化に適している
- 鍵を安全に共有する「鍵配送問題」が最大の課題
- 主な用途：セッション通信の暗号化、ファイル暗号化など

## 📝 ② ハッシュ化 - パスワードを安全に保管する技術
ハッシュ化は、任意の長さのデータを固定長の出力（ハッシュ値）に変換する一方向の関数です。パスワードを原文のまま保存せず、ハッシュ値として保存することで、万が一データベースが流出しても実際のパスワードは保護されます。

💬   
Bくん：「Aさん、サービスって私たちのパスワードをそのまま保存してるの？それって危なくない？」

Aさん：「いい質問だね！きちんと設計されたシステムでは、パスワードをそのまま保存することはないよ。代わりに『ハッシュ化』という技術を使ってパスワードを変換して保存しているんだ」

Bくん：「ハッシュ化？なんか料理みたいな名前ですね。どんな技術なんですか？」

Aさん：「簡単に言うと、パスワードを一方通行の関数に通して、元に戻せない別の文字列に変換する技術だよ。例えば『password123』というパスワードは『ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f』みたいな一見ランダムな文字列になる。この変換は一方通行で、ハッシュ値から元のパスワードを計算で求めることはできないんだ」

Bくん：「へぇ〜！でも一方通行なら、ログイン時にどうやってパスワードが合ってるか確認するんですか？」

Aさん：「ログイン時は、入力されたパスワードを同じハッシュ関数に通して、保存されているハッシュ値と比較するんだ。元のパスワードが同じなら、ハッシュ値も同じになるからね。でも重要なのは、実はパスワードだけをハッシュ化すると問題があるんだ。『ソルト』と呼ばれるランダムな値をパスワードに追加してからハッシュ化するんだよ」

Bくん：「ソルト？塩ですか？なぜ塩が必要なんですか？」

Aさん：「名前は塩から来てるけど、実際はユーザーごとに生成するランダムな文字列だよ。これをパスワードに追加することで、同じパスワードを使っているユーザーでも異なるハッシュ値になるんだ。例えば『password123』+『A7bC9z』というソルトは、『password123』+『X3yF1q』という別のソルトとは全く異なるハッシュ値になる。これにより『レインボーテーブル』と呼ばれる事前計算された攻撃からも守れるんだよ」

### 📌 ポイント
- ハッシュ化は一方向の関数で、元の入力を復元することはできない
- 同じ入力からは常に同じハッシュ値が生成される
- 入力が少し変わるだけでハッシュ値は大きく変わる（雪崩効果）
- ソルト（ランダムな値）をパスワードに追加してからハッシュ化することで、同じパスワードでも異なるハッシュ値になり、セキュリティが向上する

## 📝 ③ 公開鍵暗号方式 - 鍵のペアで実現する安全な通信
公開鍵暗号方式は、公開鍵と秘密鍵というペアの鍵を使用する暗号化技術です。デジタル署名やSSL/TLS通信など、現代のインターネットセキュリティの多くの部分を支えています。

💬   
Aさん：「次に紹介するのは『公開鍵暗号方式』だよ。これは暗号化と復号に異なる鍵を使う方式で、先ほどの共通鍵暗号の弱点を解決する画期的な技術なんだ」

Bくん：「公開鍵って名前は聞いたことあります！でも具体的にどんな仕組みなんですか？」

Aさん：「公開鍵暗号では、『公開鍵』と『秘密鍵』という二つの関連する鍵を使うんだ。
- **公開鍵**: 誰にでも公開できる鍵。これで暗号化したデータは、対応する秘密鍵でしか復号できない
- **秘密鍵**: 絶対に他人に教えない鍵。これで暗号化したデータは、対応する公開鍵で検証できる（デジタル署名）

この特性を利用して、安全な通信や本人確認ができるんだよ」

Bくん：「なるほど！でも鍵が二つあるって複雑そう...実際にどう使われているんですか？」

Aさん：「身近な例で言うと、ほとんどのウェブサイトで使われているHTTPS通信だね。実はHTTPSは公開鍵暗号と共通鍵暗号の良いとこどりをしているんだよ。まず初期段階（ハンドシェイク）で公開鍵暗号を使って安全に『セッション鍵』という共通鍵を交換するんだ。そしてその後の通信は、その共通鍵を使って高速に暗号化するよ。公開鍵暗号は安全だけど計算が重いから、初期の鍵交換だけに使って、あとは処理が軽い共通鍵暗号を使うという賢い方法なんだ」

Bくん：「へぇ〜、組み合わせて使うんですね！マイナンバーカードにも使われてるって言ってましたよね？」

Aさん：「そうだよ。マイナンバーカードの電子証明書も公開鍵暗号を使っていて、カード内に秘密鍵、公的機関に公開鍵が登録されている状態なんだ。ここで重要なのが『電子署名』の仕組みなんだけど、これにはさっき説明したハッシュ化も組み合わせて使うんだよ」

Bくん：「電子署名にハッシュ化も使うんですか？どうやって？」

Aさん：「例えば、ある文書に電子署名するとき、まず文書全体のハッシュ値を計算するんだ。そして、そのハッシュ値を秘密鍵で暗号化する。これが電子署名になるよ。なぜハッシュ値を使うかというと、データ量を減らせるし、文書の一部でも変更されれば完全に異なるハッシュ値になるから改ざん検知ができるんだ。検証する側は、受け取った文書からハッシュ値を計算し、署名を公開鍵で復号化したハッシュ値と比較する。一致すれば、その文書は確かに秘密鍵の持ち主が署名したもので、途中で改ざんされていないと確認できるんだよ」

### 📌 ポイント
- 公開鍵と秘密鍵はペアで生成され、数学的に関連しているが、公開鍵から秘密鍵を算出することは計算量的に非常に困難
- HTTPS通信では、公開鍵暗号方式（安全性が高いが処理が重い）と共通鍵暗号方式（処理が軽い）を組み合わせて使用
- 電子署名では、文書のハッシュ値を秘密鍵で暗号化する手法が一般的
- これにより、署名者の本人確認だけでなく、文書の改ざん検知も可能になる

## 📝 ④ ハードトークン - 物理的なセキュリティデバイス
ハードトークンは、認証に必要な情報や機能を持つ物理的なデバイスです。ワンタイムパスワード生成器やスマートカードなど様々な形態があり、「持っているもの」による強力な認証手段を提供します。

💬   
Aさん：「最後に紹介するのは『ハードトークン』だよ。これは物理的に持つセキュリティデバイスで、『あなたが持っているもの』による認証を実現するんだ」

Bくん：「物理的なデバイスですか？具体的にはどんなものがあるんですか？」

Aさん：「ハードトークンには大きく分けていくつかの種類があるよ。実際に見たことあるかもしれないから、具体的に説明するね。

- **OTPトークン**: デジタル時計のような小型デバイスで、6桁程度の数字が30秒おきに変わるもの。銀行の法人向けサービスでよく使われていて、ログイン時にその時点で表示されている数字を入力する。RSA SecurIDという製品が有名だよ。

- **USBセキュリティキー**: 親指サイズの小さなUSBデバイスで、パソコンやスマホに接続して使う。YubiKeyやGoogle Titanなどが代表的で、デバイスのボタンを押すだけで強固な認証ができる。Googleの社員は全員これを使ってアカウント乗っ取りをほぼゼロにしたことでも知られているよ。

- **スマートカード**: クレジットカードサイズでICチップが埋め込まれたカード。企業の社員証や政府IDカードとして使われていて、カードリーダーにかざしてPINを入力することで認証する。マイナンバーカードもこの一種だね。

- **生体認証デバイス**: 指紋や静脈、虹彩などを読み取る専用機器。銀行のATMに指を置くタイプの認証や、データセンターなどの重要施設の入退室管理に使われているよ。」

Bくん：「へぇ〜、思ったより身近にあるんですね！でもなんでわざわざ物理的なデバイスが必要なんですか？スマホのアプリとかでもいいんじゃ...」

Aさん：「いい質問だね！物理的なハードトークンの大きな利点は『隔離された安全な環境』にあるんだ。例えばYubiKeyのようなUSBセキュリティキーには、秘密鍵を絶対に外部に出さない特殊なチップが搭載されていて、マルウェアに感染したPCでも安全に認証できるんだよ。またRSA SecurIDのようなOTPトークンも、インターネットに接続されていないから遠隔攻撃のリスクがほぼないんだ。高セキュリティが求められる環境、例えば銀行のシステム管理者や重要インフラの制御には、こうしたハードウェアベースの対策が不可欠なんだよ」

### 📌 ポイント
- ハードトークンは「持っているもの」による認証を実現し、パスワードだけよりも安全性が高い
- 物理的に隔離された環境で認証情報を処理するため、マルウェアなどの脅威に強い
- 一部のハードトークンは、秘密鍵を絶対に外部に出さない設計になっている
- FIDO2/WebAuthn規格に対応したセキュリティキーは、フィッシング耐性も持つ


------------------------------------------------------------------------------------------

## まとめ
認証システムの安全性は、共通鍵暗号方式の効率性、ハッシュ化によるパスワード保護、公開鍵暗号方式による安全な通信と署名、そしてハードトークンによる多要素認証など、様々な技術の組み合わせによって支えられています。これらの技術を理解することで、なぜ特定の認証方法が安全とされるのか、その理由が明確になります。

### 📌📌今回のポイント📌📌
1. 共通鍵暗号方式は高速だが、安全な鍵の共有が課題
2. パスワードはソルトを加えてハッシュ化して保存することで、データベース漏洩時でも実際のパスワードを保護できる
3. 公開鍵暗号方式は、暗号化と署名の両方に使え、現代のウェブサイトのセキュリティや本人確認の基盤となっている
4. HTTPS通信では公開鍵暗号と共通鍵暗号を組み合わせ、電子署名ではハッシュ化と公開鍵暗号を組み合わせる
5. ハードトークンは物理的に隔離された安全な環境で認証処理を行うため、高いセキュリティを実現できる

## 参考資料
[1] NIST Special Publication 800-63B - Digital Identity Guidelines: Authentication and Lifecycle Management  
[2] 総務省「公的個人認証サービス（JPKI）」 https://www.soumu.go.jp/kojinbango_card/kojinninshou-01.html  
[3] FIDO Alliance "WebAuthn" https://fidoalliance.org/fido2/  
